version: '3.8'

services:
   app:
    image: api:latest # whatever image you built
    expose:
      - '5678'
    ports:
      - '5678:5678'
    env_file:
      - apps/app/.env
    environment:
      - CHROMA_URL=http://chroma:8000
      - REDIS_URL=redis://redis:6379
    volumes:
      - ./apps/app/matrix-storage:/app/matrix-storage

  redis:
    image: redis:alpine
    container_name: ixo-redis
    ports:
      - '6379:6379'
    volumes:
      - redis-data:/data
    command: redis-server --appendonly yes

  redis-insight:
    image: redis/redisinsight:latest
    container_name: ixo-redis-insight
    ports:
      - '8001:8001'
    volumes:
      - redis-data:/db
    environment:
      - REDIS_HOST=redis

  nginx:
    image: nginx:alpine
    container_name: ixo-nginx
    ports:
      - '5678:80'
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app

volumes:
  redis-data:
